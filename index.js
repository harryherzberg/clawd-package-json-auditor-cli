const { Command } = require(&#39;commander&#39;);\nconst chalk = require(&#39;chalk&#39;);\nconst puppeteer = require(&#39;puppeteer&#39;);\nconst LicenseChecker = require(&#39;license-checker-rseidelsohn&#39;);\nconst axios = require(&#39;axios&#39;);\nconst semver = require(&#39;semver&#39;);\nconst fs = require(&#39;fs/promises&#39;);\nconst path = require(&#39;path&#39;);\n\nconst program = new Command()\n  .name(&#39;pkg-audit&#39;)\n  .description(&#39;Audit package.json deps/licenses/scripts&#39;)\n  .argument(&#39;[dir]&#39;, &#39;Project dir&#39;, &#39;.&#39;)\n  .option(&#39;--license-key &lt;key&gt;&#39;, &#39;Pro license key&#39;)\n  .action(async (dir, options) =&gt; {\n    const licenseKey = options.licenseKey || process.env.PKG_AUDIT_LICENSE || &#39;DEMO&#39;;\n    const fullDir = path.resolve(dir);\n    let pkg;\n    try {\n      pkg = JSON.parse(await fs.readFile(path.join(fullDir, &#39;package.json&#39;), &#39;utf8&#39;));\n    } catch (e) {\n      console.log(chalk.red(&#39;No package.json found&#39;));\n      return;\n    }\n    const issues = [];\n    // Suspicious scripts\n    if (pkg.scripts) {\n      for (const [name, script] of Object.entries(pkg.scripts)) {\n        if (/rm\\s+-rf|curl.*bash|wget.*bash|eval|fs\\.rm.*danger/i.test(script)) {\n          issues.push({\n            type: &#39;suspicious-script&#39;,\n            name,\n            script: script.slice(0, 40) + &#39;...&#39;\n          });\n        }\n      }\n    }\n    // Risky licenses &amp; Outdated deps\n    LicenseChecker.init({\n      start: fullDir,\n      production: true,\n      development: true\n    }, async (err, licenses) =&gt; {\n      if (!err &amp;&amp; licenses) {\n        for (const [pkgName, data] of Object.entries(licenses)) {\n          const lic = data.license || data.licenses;\n          if (lic &amp;&amp; (lic.includes(&#39;GPL&#39;) || lic.includes(&#39;AGPL&#39;) || lic.includes(&#39;copyleft&#39;))) {\n            issues.push({\n              type: &#39;risky-license&#39;,\n              package: pkgName,\n              license: lic\n            });\n          }\n        }\n      }\n      // Outdated deps\n      const fields = [&#39;dependencies&#39;, &#39;devDependencies&#39;];\n      for (const field of fields) {\n        if (pkg[field]) {\n          for (const [name, range] of Object.entries(pkg[field])) {\n            try {\n              const {data} = await axios.get(`https://registry.npmjs.org/${name}`, {timeout: 3000});\n              const latest = data[&#39;dist-tags&#39;].latest;\n              const cleanRange = range.replace(/^[~^]/, &#39;&#39;);\n              if (semver.gt(latest, cleanRange)) {\n                issues.push({\n                  type: &#39;outdated-dep&#39;,\n                  package: name,\n                  current: range,\n                  latest\n                });\n              }\n            } catch {}\n          }\n        }\n      }\n      // Output\n      console.log(chalk.cyan.bold(&#39;\\nPackage.json Audit Results:&#39;));\n      console.table(issues);\n      if (licenseKey !== &#39;DEMO-PRO&#39;) {\n        console.log(chalk.red(&#39;\\n❌ DEMO MODE - Buy pro key from Gumroad for PDF/exports ($29)\\n&#39;));\n        return;\n      }\n      // Pro PDF\n      const html = `\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;&lt;title&gt;Pkg Audit Report&lt;/title&gt;\n&lt;style&gt;table {border-collapse: collapse; width:100%;} th,td {border:1px solid #ddd; padding:8px;} th{background:#f2f2f2;}&lt;/style&gt;&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;Package.json Audit Report&lt;/h1&gt;\n&lt;table&gt;\n&lt;tr&gt;&lt;th&gt;Type&lt;/th&gt;&lt;th&gt;Details&lt;/th&gt;&lt;/tr&gt;\n${issues.map(issue =&gt; `&lt;tr&gt;&lt;td&gt;${issue.type.replace(&#39;-&#39;,&#39; &#39;)}&lt;/td&gt;&lt;td&gt;${JSON.stringify(issue).slice(1,-1).replace(/&quot;/g,&#39;&amp;quot;&#39;)}&lt;/td&gt;&lt;/tr&gt;` ).join(&#39;&#39;)}\n&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;`;\n      const browser = await puppeteer.launch({headless: &quot;new&quot;});\n      const page = await browser.newPage();\n      await page.setContent(html, {waitUntil: &#39;networkidle0&#39;});\n      await page.pdf({path: &#39;pkg-audit-report.pdf&#39;, format: &#39;A4&#39;, printBackground: true});\n      await browser.close();\n      console.log(chalk.green(&#39;\\n✅ Pro report saved: pkg-audit-report.pdf&#39;));\n    });\n  });\n\nprogram.parse();